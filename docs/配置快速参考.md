# Print Proxy Service - 配置快速参考

## 🚀 快速开始

```powershell
# 1. 复制配置模板
copy .env.example .env

# 2. 编辑配置（可选）
notepad .env

# 3. 启动服务
.\scripts\windows\start_server.ps1
```

## 📋 常用命令

| 命令 | 说明 |
|------|------|
| `.\scripts\windows\start_server.ps1` | 启动服务（使用配置文件） |
| `.\scripts\windows\start_server.ps1 -ShowConfig` | 显示当前配置 |
| `.\scripts\windows\start_server.ps1 -Port 9000` | 使用指定端口启动 |
| `.\scripts\windows\start_server.ps1 -Help` | 显示帮助信息 |
| `python scripts\show_config.py` | 查看详细配置 |
| `python scripts\validate_config.py` | 验证配置 |

## ⚙️ 核心配置项

### 服务器配置

```env
# 主机地址（0.0.0.0=所有接口，127.0.0.1=仅本地）
SERVER_HOST=0.0.0.0

# 端口号
SERVER_PORT=8568

# 自动重载（开发模式）
SERVER_RELOAD=false
```

### 安全配置

```env
# JWT 密钥（生产环境必须修改！）
JWT_SECRET_KEY=change_me_to_a_random_secret_key

# Token 过期时间（分钟）
ACCESS_TOKEN_EXPIRE_MINUTES=10080
```

### 日志配置

```env
# 日志级别：DEBUG, INFO, WARNING, ERROR
LOG_LEVEL=INFO

# 日志目录（留空使用默认）
LOG_DIRECTORY=
```

## 📁 配置文件位置

### 开发环境
```
项目根目录/
├── .env              ← 在这里
├── config.yaml       ← 或这里
└── ...
```

### 生产环境（EXE）
```
C:\Program Files\PrintProxy\
├── PrintProxy.exe
├── .env              ← 在这里
└── config.yaml       ← 或这里
```

## 🔧 配置方式对比

| 方式 | 优先级 | 适用场景 |
|------|--------|----------|
| 环境变量 | 最高 | 临时测试、容器部署 |
| .env 文件 | 高 | **推荐**，开发和生产 |
| config.yaml | 中 | 复杂配置、团队协作 |
| 默认值 | 最低 | 快速开始 |

## 🌐 访问地址

启动后访问：

| 地址 | 说明 |
|------|------|
| `http://localhost:8568` | 主页 |
| `http://localhost:8568/docs` | API 文档（Swagger） |
| `http://localhost:8568/admin` | 管理界面 |
| `http://localhost:8568/api` | API 端点 |

## 🔍 常见场景

### 场景 1：仅本地访问
```env
SERVER_HOST=127.0.0.1
SERVER_PORT=8568
```

### 场景 2：局域网访问
```env
SERVER_HOST=0.0.0.0
SERVER_PORT=8568
```

### 场景 3：更换端口（避免冲突）
```env
SERVER_HOST=0.0.0.0
SERVER_PORT=9000
```

### 场景 4：开发调试
```env
SERVER_HOST=127.0.0.1
SERVER_PORT=8568
SERVER_RELOAD=true
LOG_LEVEL=DEBUG
```

### 场景 5：生产环境
```env
SERVER_HOST=0.0.0.0
SERVER_PORT=8568
SERVER_RELOAD=false
LOG_LEVEL=INFO
JWT_SECRET_KEY=your_very_secure_random_key_here
```

## ⚠️ 重要提示

### 安全警告
- ⚠️ 生产环境**必须**修改 `JWT_SECRET_KEY`
- ⚠️ 不要将 `.env` 文件提交到版本控制
- ⚠️ 使用 `0.0.0.0` 时注意防火墙设置

### 端口冲突
```powershell
# 检查端口占用
netstat -ano | findstr :8568

# 解决方法：修改配置中的 SERVER_PORT
```

### 权限问题
- 数据库和日志自动存储在用户目录：`%APPDATA%\PrintProxy\`
- 无需管理员权限即可运行

## 📚 详细文档

| 文档 | 说明 |
|------|------|
| [配置说明.md](docs/配置说明.md) | 完整配置文档 |
| [配置迁移指南.md](docs/配置迁移指南.md) | 版本升级指南 |
| [CHANGELOG_配置系统.md](CHANGELOG_配置系统.md) | 更新日志 |

## 🆘 故障排查

### 问题：配置不生效
```powershell
# 查看实际使用的配置
python scripts\show_config.py
```

### 问题：端口被占用
```powershell
# 方法 1：修改配置文件
notepad .env  # 修改 SERVER_PORT

# 方法 2：使用命令行参数
.\scripts\windows\start_server.ps1 -Port 9000
```

### 问题：服务无法启动
```powershell
# 验证配置
python scripts\validate_config.py

# 查看日志
type %APPDATA%\PrintProxy\logs\printproxy_*.log
```

## 🔄 向后兼容

旧版环境变量仍然支持：

| 旧变量 | 新变量 |
|--------|--------|
| `PRINT_PROXY_HOST` | `SERVER_HOST` |
| `PRINT_PROXY_PORT` | `SERVER_PORT` |
| `PRINT_PROXY_RELOAD` | `SERVER_RELOAD` |

## 💡 提示

- 使用 `.env` 文件最简单（推荐）
- 配置文件支持注释（`#` 开头）
- 修改配置后需要重启服务
- 使用 `.\scripts\windows\start_server.ps1 -ShowConfig` 快速查看配置

---

**需要帮助？** 运行 `.\scripts\windows\start_server.ps1 -Help` 或查看详细文档
