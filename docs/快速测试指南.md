# PrintProxy å¿«é€Ÿæµ‹è¯•æŒ‡å—

## âœ… å·²å®Œæˆä¿®å¤

### ä¿®å¤çš„é—®é¢˜
- âŒ æ—§ç‰ˆï¼šæ•°æ®åº“å’Œæ—¥å¿—å†™å…¥ `C:\Program Files\PrintProxy\`ï¼ˆæ— æƒé™ï¼‰
- âœ… æ–°ç‰ˆï¼šæ•°æ®åº“å’Œæ—¥å¿—å†™å…¥ `%APPDATA%\PrintProxy\`ï¼ˆæœ‰æƒé™ï¼‰

### ä¿®æ”¹çš„æ–‡ä»¶
1. **app/core/config.py** - æ•°æ®åº“å’Œæ—¥å¿—è·¯å¾„æ”¹ä¸ºç”¨æˆ·ç›®å½•
2. **scripts/windows/run_app.py** - æ‰€æœ‰æ—¥å¿—è·¯å¾„æ”¹ä¸ºç”¨æˆ·ç›®å½•
3. **dist/PrintProxy.exe** - å·²é‡æ–°æ„å»ºï¼ˆ53.8 MBï¼‰
4. **scripts/windows/PrintProxySetup_1.0.0.exe** - å·²é‡æ–°æ„å»ºï¼ˆ51.3 MBï¼‰

---

## ğŸ§ª æµ‹è¯•æ­¥éª¤

### æ­¥éª¤ 1ï¼šå¸è½½æ—§ç‰ˆæœ¬ï¼ˆå¦‚æœå·²å®‰è£…ï¼‰

```powershell
# æ‰“å¼€ PowerShellï¼ˆæ— éœ€ç®¡ç†å‘˜æƒé™ï¼‰

# æ–¹æ³• 1ï¼šæ§åˆ¶é¢æ¿å¸è½½
æ§åˆ¶é¢æ¿ â†’ ç¨‹åºå’ŒåŠŸèƒ½ â†’ æ‰¾åˆ° "Print Proxy" â†’ å¸è½½

# æˆ–æ–¹æ³• 2ï¼šæ‰‹åŠ¨åˆ é™¤æ³¨å†Œè¡¨ï¼ˆå¦‚æœå¸è½½å¤±è´¥ï¼‰
Remove-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Run" -Name "Print Proxy" -ErrorAction SilentlyContinue

# åœæ­¢è¿è¡Œçš„è¿›ç¨‹
Stop-Process -Name PrintProxy -Force -ErrorAction SilentlyContinue

# åˆ é™¤æ—§çš„æ•°æ®æ–‡ä»¶
Remove-Item -Path "$env:APPDATA\PrintProxy" -Recurse -Force -ErrorAction SilentlyContinue
```

### æ­¥éª¤ 2ï¼šå®‰è£…æ–°ç‰ˆæœ¬

```powershell
# ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œå®‰è£…å™¨
å³é”® scripts\windows\PrintProxySetup_1.0.0.exe
â†’ é€‰æ‹©"ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œ"
â†’ ç‚¹å‡» "Next" â†’ é€‰æ‹©å®‰è£…ç›®å½• â†’ ç‚¹å‡» "Install"
â†’ å®‰è£…å®Œæˆåï¼Œé€‰æ‹© "Yes" ç«‹å³å¯åŠ¨ç¨‹åº
```

**æ³¨æ„ï¼š** å®‰è£…æ—¶éœ€è¦ç®¡ç†å‘˜æƒé™ï¼Œä½†è¿è¡Œæ—¶ä»¥æ™®é€šç”¨æˆ·æƒé™è¿è¡Œã€‚

### æ­¥éª¤ 3ï¼šéªŒè¯å®‰è£…

```powershell
# 1. æ£€æŸ¥å®‰è£…ç›®å½•ï¼ˆåªè¯»æ–‡ä»¶ï¼‰
dir "C:\Program Files\PrintProxy\"

# é¢„æœŸè¾“å‡ºï¼š
# PrintProxy.exe
# app\templates\

# 2. æ£€æŸ¥ç”¨æˆ·æ•°æ®ç›®å½•ï¼ˆå¯å†™æ–‡ä»¶ï¼‰
dir "$env:APPDATA\PrintProxy"

# é¢„æœŸè¾“å‡ºï¼š
# print_proxy.db
# logs\

# 3. æ£€æŸ¥æ³¨å†Œè¡¨
Get-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Run" -Name "Print Proxy"

# é¢„æœŸè¾“å‡ºï¼š
# Print Proxy : "C:\Program Files\PrintProxy\PrintProxy.exe"
```

### æ­¥éª¤ 4ï¼šæ£€æŸ¥è¿›ç¨‹å’ŒæœåŠ¡

```powershell
# æ£€æŸ¥è¿›ç¨‹æ˜¯å¦è¿è¡Œ
tasklist | findstr PrintProxy

# é¢„æœŸè¾“å‡ºï¼š
# PrintProxy.exe                 12345 Console                    1    120,000 K

# æ£€æŸ¥ç«¯å£ç›‘å¬
netstat -ano | findstr :8568

# é¢„æœŸè¾“å‡ºï¼š
# TCP    0.0.0.0:8568           0.0.0.0:0              LISTENING       12345

# æµ‹è¯• HTTP æœåŠ¡
curl http://localhost:8568/docs

# é¢„æœŸè¾“å‡ºï¼š
# è¿”å› HTML é¡µé¢ï¼ˆSwagger UIï¼‰
```

### æ­¥éª¤ 5ï¼šæ£€æŸ¥æ—¥å¿—æ–‡ä»¶

```powershell
# æŸ¥çœ‹æ—¥å¿—ï¼ˆæœ€å…³é”®çš„éªŒè¯æ­¥éª¤ï¼ï¼‰
Get-Content "$env:APPDATA\PrintProxy\logs\printproxy_*.log" -Tail 30

# é¢„æœŸè¾“å‡ºåº”è¯¥åŒ…å«ï¼ˆæ— æƒé™é”™è¯¯ï¼‰ï¼š
# ==========================================
# PrintProxy starting...
# Python: 3.11.13
# Working directory: C:\Program Files\PrintProxy
# Executable: C:\Program Files\PrintProxy\PrintProxy.exe
# Frozen: True
# Starting server on 0.0.0.0:8568
# Application startup complete

# æ£€æŸ¥æ˜¯å¦æœ‰æƒé™é”™è¯¯
Get-Content "$env:APPDATA\PrintProxy\logs\printproxy_*.log" | Select-String "Permission denied"

# é¢„æœŸè¾“å‡ºï¼š
# ï¼ˆæ— è¾“å‡ºï¼Œè¡¨ç¤ºæ²¡æœ‰æƒé™é”™è¯¯ï¼‰âœ…

# æ£€æŸ¥æ•°æ®åº“è·¯å¾„
Get-Content "$env:APPDATA\PrintProxy\logs\printproxy_*.log" | Select-String "database"

# åº”è¯¥èƒ½çœ‹åˆ°æ•°æ®åº“ä½ç½®åœ¨ç”¨æˆ·ç›®å½•
```

### æ­¥éª¤ 6ï¼šæ£€æŸ¥æ•°æ®åº“

```powershell
# éªŒè¯æ•°æ®åº“æ–‡ä»¶å­˜åœ¨
Test-Path "$env:APPDATA\PrintProxy\print_proxy.db"

# é¢„æœŸè¾“å‡ºï¼šTrue

# æ£€æŸ¥æ•°æ®åº“å¤§å°
(Get-Item "$env:APPDATA\PrintProxy\print_proxy.db").Length

# é¢„æœŸè¾“å‡ºï¼šå‡  KB åˆ°å‡ å KBï¼ˆéé›¶ï¼‰
```

### æ­¥éª¤ 7ï¼šè®¿é—® Web ç•Œé¢

```powershell
# æ–¹æ³• 1ï¼šä½¿ç”¨æµè§ˆå™¨
æ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—®ï¼šhttp://localhost:8568

# æ–¹æ³• 2ï¼šä½¿ç”¨ PowerShell
Start-Process "http://localhost:8568"

# é¢„æœŸç»“æœï¼š
# - çœ‹åˆ°ç™»å½•é¡µé¢æˆ–ä¸»é¡µ
# - æ—  404 æˆ– 500 é”™è¯¯
```

### æ­¥éª¤ 8ï¼šé‡å¯ç”µè„‘æµ‹è¯•ï¼ˆæœ€é‡è¦ï¼ï¼‰

```powershell
# 1. é‡å¯ç”µè„‘
Restart-Computer

# 2. ç™»å½•åç­‰å¾… 10-15 ç§’

# 3. éªŒè¯è‡ªå¯åŠ¨
tasklist | findstr PrintProxy

# é¢„æœŸè¾“å‡ºï¼š
# PrintProxy.exe                 XXXX Console                    1    XXX,XXX K

# 4. éªŒè¯æœåŠ¡
curl http://localhost:8568/docs

# é¢„æœŸè¾“å‡ºï¼š
# è¿”å› HTML é¡µé¢ï¼ˆSwagger UIï¼‰

# 5. æŸ¥çœ‹ä»Šå¤©çš„æ—¥å¿—
Get-Content "$env:APPDATA\PrintProxy\logs\printproxy_$(Get-Date -Format 'yyyyMMdd').log" -Tail 20

# é¢„æœŸè¾“å‡ºï¼š
# ä»Šå¤©çš„å¯åŠ¨æ—¥å¿—ï¼Œæ— æƒé™é”™è¯¯ âœ…

# 6. æ£€æŸ¥è¿›ç¨‹ç”¨æˆ·
Get-Process PrintProxy | ForEach-Object {
    $owner = (Get-WmiObject Win32_Process -Filter "ProcessId=$($_.Id)").GetOwner()
    Write-Host "è¿è¡Œç”¨æˆ·: $($owner.Domain)\$($owner.User)"
}

# é¢„æœŸè¾“å‡ºï¼š
# è¿è¡Œç”¨æˆ·: [æ‚¨çš„è®¡ç®—æœºå]\[æ‚¨çš„ç”¨æˆ·å] âœ…
```

---

## âœ… æˆåŠŸæ ‡å¿—

### å®‰è£…æˆåŠŸ
- [x] å®‰è£…å™¨è¿è¡Œå®Œæˆï¼Œæ— é”™è¯¯
- [x] Program Files ç›®å½•åŒ…å« PrintProxy.exe
- [x] ç”¨æˆ·æ•°æ®ç›®å½•è‡ªåŠ¨åˆ›å»º
- [x] HKCU æ³¨å†Œè¡¨åŒ…å«è‡ªå¯åŠ¨é¡¹

### è¿è¡ŒæˆåŠŸ
- [x] è¿›ç¨‹ PrintProxy.exe æ­£å¸¸è¿è¡Œ
- [x] ç«¯å£ 8568 æ­£å¸¸ç›‘å¬
- [x] HTTP æœåŠ¡æ­£å¸¸å“åº”
- [x] æ—¥å¿—æ–‡ä»¶åœ¨ `%APPDATA%\PrintProxy\logs\`
- [x] æ•°æ®åº“æ–‡ä»¶åœ¨ `%APPDATA%\PrintProxy\print_proxy.db`
- [x] **æ—¥å¿—ä¸­æ—  "Permission denied" é”™è¯¯** â† æœ€å…³é”®

### é‡å¯æˆåŠŸ
- [x] é‡å¯åç¨‹åºè‡ªåŠ¨å¯åŠ¨
- [x] ä»¥å½“å‰ç”¨æˆ·æƒé™è¿è¡Œï¼ˆéç®¡ç†å‘˜ï¼‰
- [x] æœåŠ¡æ­£å¸¸å“åº”
- [x] æ—¥å¿—æ­£å¸¸å†™å…¥ï¼Œæ— æƒé™é”™è¯¯

---

## ğŸš¨ æ•…éšœæ’æŸ¥

### é—®é¢˜ 1ï¼šå®‰è£…åæ—¥å¿—ä»åœ¨ Program Files

**ç—‡çŠ¶ï¼š**
```powershell
Test-Path "C:\Program Files\PrintProxy\logs\"
# è¿”å› Trueï¼ˆé”™è¯¯ï¼ï¼‰
```

**åŸå› ï¼š** ä½¿ç”¨äº†æ—§ç‰ˆæœ¬çš„ EXE

**è§£å†³æ–¹æ¡ˆï¼š**
```powershell
# 1. å®Œå…¨å¸è½½
æ§åˆ¶é¢æ¿ â†’ å¸è½½ Print Proxy

# 2. åˆ é™¤æ®‹ç•™æ–‡ä»¶
Remove-Item "C:\Program Files\PrintProxy" -Recurse -Force

# 3. ç¡®è®¤ä½¿ç”¨æ–°æ„å»ºçš„ EXE
# æ£€æŸ¥ EXE æ„å»ºæ—¶é—´
(Get-Item "C:\Users\CodingYooo\Desktop\print_proxy\dist\PrintProxy.exe").LastWriteTime

# åº”è¯¥æ˜¯æœ€è¿‘æ—¶é—´ï¼ˆä»Šå¤©ï¼‰

# 4. é‡æ–°è¿è¡Œæ„å»ºè„šæœ¬
powershell -ExecutionPolicy Bypass -File "C:\Users\CodingYooo\Desktop\print_proxy\scripts\windows\build_exe.ps1"
powershell -ExecutionPolicy Bypass -File "C:\Users\CodingYooo\Desktop\print_proxy\scripts\windows\build_installer.ps1"

# 5. é‡æ–°å®‰è£…
```

### é—®é¢˜ 2ï¼šé‡å¯åæ²¡æœ‰è‡ªå¯åŠ¨

**æ£€æŸ¥æ³¨å†Œè¡¨ï¼š**
```powershell
Get-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Run" -Name "Print Proxy"

# å¦‚æœè¿”å›ç©ºæˆ–é”™è¯¯ï¼Œæ‰‹åŠ¨æ·»åŠ ï¼š
Set-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Run" -Name "Print Proxy" -Value '"C:\Program Files\PrintProxy\PrintProxy.exe"'
```

### é—®é¢˜ 3ï¼šç«¯å£è¢«å ç”¨

**æ£€æŸ¥ç«¯å£ï¼š**
```powershell
netstat -ano | findstr :8568

# å¦‚æœå·²è¢«å ç”¨ï¼Œä¿®æ”¹ç«¯å£ï¼š
[System.Environment]::SetEnvironmentVariable("PRINT_PROXY_PORT", "9000", "User")

# é‡å¯ç¨‹åº
Stop-Process -Name PrintProxy -Force
& "C:\Program Files\PrintProxy\PrintProxy.exe"
```

### é—®é¢˜ 4ï¼šæ—¥å¿—ä¸­ä»æœ‰æƒé™é”™è¯¯

**æŸ¥çœ‹å®Œæ•´é”™è¯¯ï¼š**
```powershell
Get-Content "$env:APPDATA\PrintProxy\logs\printproxy_*.log" | Select-String "Permission" -Context 3,3
Get-Content "$env:APPDATA\PrintProxy\logs\error.log"

# å¦‚æœé”™è¯¯æ¶‰åŠæ•°æ®åº“ï¼Œæ£€æŸ¥æ•°æ®åº“ä½ç½®ï¼š
Get-Content "$env:APPDATA\PrintProxy\logs\printproxy_*.log" | Select-String "database\|sqlite"
```

**å¯èƒ½åŸå› ï¼š**
1. EXE æœªä½¿ç”¨æ–°ä»£ç  â†’ é‡æ–°æ„å»º
2. ç¯å¢ƒå˜é‡ DATABASE_URL è®¾ç½®é”™è¯¯ â†’ åˆ é™¤ç¯å¢ƒå˜é‡
3. æ—§çš„é…ç½®æ–‡ä»¶æ®‹ç•™ â†’ æ¸…ç†ç”¨æˆ·ç›®å½•é‡æ–°å®‰è£…

---

## ğŸ“Š éªŒè¯æ¸…å•

### å¿«é€ŸéªŒè¯ï¼ˆ5 åˆ†é’Ÿï¼‰

```powershell
# ä¸€é”®æ£€æŸ¥è„šæœ¬
powershell -ExecutionPolicy Bypass -Command "
Write-Host '=== PrintProxy å¿«é€ŸéªŒè¯ ===' -ForegroundColor Cyan
Write-Host ''

# 1. æ£€æŸ¥è¿›ç¨‹
Write-Host '[1/6] è¿›ç¨‹æ£€æŸ¥...' -NoNewline
if (Get-Process PrintProxy -ErrorAction SilentlyContinue) {
    Write-Host ' [OK]' -ForegroundColor Green
} else {
    Write-Host ' [å¤±è´¥] è¿›ç¨‹æœªè¿è¡Œ' -ForegroundColor Red
}

# 2. æ£€æŸ¥ç«¯å£
Write-Host '[2/6] ç«¯å£æ£€æŸ¥...' -NoNewline
if (netstat -ano | findstr ':8568.*LISTENING') {
    Write-Host ' [OK]' -ForegroundColor Green
} else {
    Write-Host ' [å¤±è´¥] ç«¯å£æœªç›‘å¬' -ForegroundColor Red
}

# 3. æ£€æŸ¥ç”¨æˆ·æ•°æ®ç›®å½•
Write-Host '[3/6] ç”¨æˆ·æ•°æ®ç›®å½•...' -NoNewline
if (Test-Path `$env:APPDATA\PrintProxy) {
    Write-Host ' [OK]' -ForegroundColor Green
} else {
    Write-Host ' [å¤±è´¥] ç›®å½•ä¸å­˜åœ¨' -ForegroundColor Red
}

# 4. æ£€æŸ¥æ•°æ®åº“
Write-Host '[4/6] æ•°æ®åº“æ–‡ä»¶...' -NoNewline
if (Test-Path `$env:APPDATA\PrintProxy\print_proxy.db) {
    Write-Host ' [OK]' -ForegroundColor Green
} else {
    Write-Host ' [å¤±è´¥] æ•°æ®åº“ä¸å­˜åœ¨' -ForegroundColor Red
}

# 5. æ£€æŸ¥æ—¥å¿—
Write-Host '[5/6] æ—¥å¿—æ–‡ä»¶...' -NoNewline
if (Test-Path `$env:APPDATA\PrintProxy\logs\printproxy_*.log) {
    Write-Host ' [OK]' -ForegroundColor Green
} else {
    Write-Host ' [å¤±è´¥] æ—¥å¿—ä¸å­˜åœ¨' -ForegroundColor Red
}

# 6. æ£€æŸ¥æƒé™é”™è¯¯
Write-Host '[6/6] æƒé™é”™è¯¯æ£€æŸ¥...' -NoNewline
`$errors = Get-Content `$env:APPDATA\PrintProxy\logs\printproxy_*.log -ErrorAction SilentlyContinue | Select-String 'Permission denied'
if (`$errors) {
    Write-Host ' [å¤±è´¥] å‘ç°æƒé™é”™è¯¯' -ForegroundColor Red
    `$errors | ForEach-Object { Write-Host `$_ -ForegroundColor Yellow }
} else {
    Write-Host ' [OK] æ— æƒé™é”™è¯¯' -ForegroundColor Green
}

Write-Host ''
Write-Host '=== éªŒè¯å®Œæˆ ===' -ForegroundColor Cyan
"
```

---

## ğŸ¯ é¢„æœŸç»“æœæ€»ç»“

| æ£€æŸ¥é¡¹ | é¢„æœŸç»“æœ | è¯´æ˜ |
|--------|---------|------|
| å®‰è£…ç›®å½• | `C:\Program Files\PrintProxy\` | ä»…åŒ…å« EXE å’Œ templates |
| æ•°æ®ç›®å½• | `%APPDATA%\PrintProxy\` | åŒ…å«æ•°æ®åº“å’Œæ—¥å¿— |
| æ•°æ®åº“ä½ç½® | `%APPDATA%\PrintProxy\print_proxy.db` | âœ… ç”¨æˆ·å¯å†™ |
| æ—¥å¿—ä½ç½® | `%APPDATA%\PrintProxy\logs\` | âœ… ç”¨æˆ·å¯å†™ |
| æ³¨å†Œè¡¨ | HKCU\...\Run\Print Proxy | âœ… ç”¨æˆ·çº§è‡ªå¯åŠ¨ |
| è¿›ç¨‹ç”¨æˆ· | å½“å‰ç™»å½•ç”¨æˆ· | âœ… éç®¡ç†å‘˜ |
| æƒé™é”™è¯¯ | æ—  | âœ… æœ€å…³é”® |
| HTTP æœåŠ¡ | http://localhost:8568 | âœ… æ­£å¸¸å“åº” |

---

## ğŸ“ æŠ€æœ¯æ”¯æŒå‘½ä»¤

```powershell
# æ”¶é›†è¯Šæ–­ä¿¡æ¯
powershell -ExecutionPolicy Bypass -Command "
Write-Host '=== PrintProxy è¯Šæ–­ä¿¡æ¯ ===' -ForegroundColor Cyan
Write-Host ''

Write-Host '--- è¿›ç¨‹ä¿¡æ¯ ---'
Get-Process PrintProxy -ErrorAction SilentlyContinue | Select-Object Id, ProcessName, StartTime, WorkingSet

Write-Host ''
Write-Host '--- ç«¯å£ä¿¡æ¯ ---'
netstat -ano | findstr :8568

Write-Host ''
Write-Host '--- æ–‡ä»¶ä½ç½® ---'
Write-Host 'EXE:' (Get-Item 'C:\Program Files\PrintProxy\PrintProxy.exe' -ErrorAction SilentlyContinue).FullName
Write-Host 'DB:' (Get-Item `$env:APPDATA\PrintProxy\print_proxy.db -ErrorAction SilentlyContinue).FullName
Write-Host 'Logs:' (Get-Item `$env:APPDATA\PrintProxy\logs -ErrorAction SilentlyContinue).FullName

Write-Host ''
Write-Host '--- æ³¨å†Œè¡¨ ---'
(Get-ItemProperty -Path 'HKCU:\Software\Microsoft\Windows\CurrentVersion\Run' -Name 'Print Proxy' -ErrorAction SilentlyContinue).'Print Proxy'

Write-Host ''
Write-Host '--- æœ€è¿‘æ—¥å¿— (æœ€å10è¡Œ) ---'
Get-Content `$env:APPDATA\PrintProxy\logs\printproxy_*.log -Tail 10 -ErrorAction SilentlyContinue

Write-Host ''
Write-Host '--- æƒé™é”™è¯¯ ---'
Get-Content `$env:APPDATA\PrintProxy\logs\printproxy_*.log -ErrorAction SilentlyContinue | Select-String 'Permission'

Write-Host ''
Write-Host '=== è¯Šæ–­å®Œæˆ ===' -ForegroundColor Cyan
"
```

---

**ç‰ˆæœ¬ï¼š** 1.0.1  
**æµ‹è¯•æ—¥æœŸï¼š** å¾…æµ‹è¯•  
**é¢„æœŸç»“æœï¼š** âœ… é‡å¯åè‡ªåŠ¨å¯åŠ¨ï¼Œæ— æƒé™é”™è¯¯
